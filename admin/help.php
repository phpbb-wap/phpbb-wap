<?php/*** @package phpBB-WAP* @copyright (c) phpBB Group* @Оптимизация под WAP: Гутник Игорь ( чел ).* @简体中文：中文phpBB-WAP团队* @license http://opensource.org/licenses/gpl-license.php**//*** 这是一款自由软件, 您可以在 Free Software Foundation 发布的* GNU General Public License 的条款下重新发布或修改; 您可以* 选择目前 version 2 这个版本（亦可以选择任何更新的版本，由* 你喜欢）作为新的牌照.**/define('IN_PHPBB', true);	$no_page_header = false;define('ROOT_PATH', './../');require('pagestart.php');$mode = get_var('mode', '');if ($mode == 'bbcode'){	redirect(append_sid('rules.php?mode=faq&act=bbcode', true));}else if ($mode == 'mbb'){	if (count($modules->bbcode_exp))	{		foreach ($modules->bbcode_exp as $key => $value)		{			$template->assign_block_vars('mods_mbb', array(				'TAG' 		=> $key,				'METHOD' 	=> $value)			);				}	}	else	{		$template->assign_block_vars('empty_mods_mbb', array());	}	$template->set_filenames(array(		'body' => 'admin/help_module_bbcode.tpl')	);		$template->assign_vars(array(		'U_HELP' 	=> append_sid('help.php'))	);}else if ($mode == 'version'){	$version = json_decode(file_get_contents('http://api.phpbb-wap.com/version.php?v=' . $board_config['version']));	if ($version->error) trigger_error('无法检测版本信息，请前往http://phpbb-wap.com/进行了解');	$template->set_filenames(array(		'body' => 'admin/help_version.tpl')	);		$template->assign_vars(array(		'U_HELP' 	=> append_sid('help.php'))	);	if ($version->new)	{		$confirm = ( isset($_POST['confirm']) ) ? true : false;		if ( isset($_POST['cancel']) )		{			redirect(append_sid('admin/help.php', true));		}		if( !$confirm )		{			confirm_box(				'版本更新', 				'版本更新', 				'发现新版本，是否把 ' . $board_config['version'] . ' 更新到 ' . $version->next . ' ？', 				append_sid('help.php?mode=version')			);		}		if (@ini_get('allow_url_fopen') == '1' || strtolower(@ini_get('allow_url_fopen')) == 'on')		{			$server_protocol 	= ($board_config['cookie_secure']) ? 'https://' : 'http://';			$server_name 		= preg_replace('/^\/?(.*?)\/?$/', '\1', trim($board_config['server_name']));			$server_port 		= ($board_config['server_port'] <> 80) ? ':' . trim($board_config['server_port']) : '';			$script_name 		= preg_replace('/^\/?(.*?)\/?$/', '/\1', trim($board_config['script_path']));			$update_url			= $server_protocol . $server_name . $server_port . $script_name .'install/install.php';			$filename = basename($version->url);			@set_time_limit(0);			@copy($version->url, ROOT_PATH . 'store/' . $filename);			require ROOT_PATH . 'includes/class/zip.php';			$zip = new PHPZip();			$zip->unZip(ROOT_PATH . 'store/' . $filename, ROOT_PATH);			die('<!DOCTYPE HTML><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8" /><title>提示</title><style type="text/css">@charset "utf-8";*{margin:0;padding:0;}body{margin:0 auto;max-width:640px;font-family:"Century Gothic","Microsoft yahei";background-color:#F9F9F9;}#wrap{background-color:#FFF;width:640px;}.error{padding:20px;margin:0;border-style:solid;border-width:1px;border-color:#000;}.main{padding:115px 0 6px 0;}</style></head><body><div id="wrap"><div class="main"><div class="error"><p style="color:red;">下载完成，请访问 ' . $update_url . ' 进行升级</p></div></div><div></body></html>');		}		else		{			trigger_error('对不起，你的服务器没有开启 allow_url_fopen，请访问 <a href="' . $version->url . '">' . $version->url . '</a> 下载进行更新' . back_link(append_sid('help.php')));		}	}	else	{		$template->assign_block_vars('not_new_version', array());	}}else{	$template->set_filenames(array(		'body' => 'admin/help_body.tpl')	);		$template->assign_vars(array(		'U_HELP_BBCODE' 	=> append_sid('help.php?mode=bbcode'),		'U_HELP_MBB' 		=> append_sid('help.php?mode=mbb'),		'U_HELP_VERSION' 	=> append_sid('help.php?mode=version'))	);}$template->pparse('body');page_footer();?>